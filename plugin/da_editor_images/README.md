# 중복 이미지 업로드 제한 플러그인

에디터에서 이미지 첨부 시 중복된 이미지가 업로드 되는 것을 방지하고, 재사용하도록 도와주는 플러그인입니다.


그누보드에 내장된 에디터들은 에디터 자체에서 이미지를 업로드할 때 `get_editor_upload_url` 이벤트를 발생시킴. 이 `get_editor_upload_url` 이벤트를 이용해 업로드된 이미지 파일의 정보룰 받아 파일의 hash를 DB에 기록하고 비교하여 중복 업로드한 이미지를 판별하여 기존 이미지를 재사용하도록 함


## 테이블 구조
- `filepath` : 그누보드 설치 위치로부터 `/{이미지파일의경로}`
- `filehash` : sha1 hash. PHP의 `sha1_file` 함수를 이용하여 생성
- `filesize` : 파일 크기
- `uploaded_count` : 해당 이미지가 업로드된 횟수
- `created_at` : 첫 기록 일시
- `updated_at` : 마지막 기록 일시

중복으로 업로드된 이미지는 `uploaded_count` 카운트를 1 증가하며, `updated_at`을 갱신함.


## 설치
최고관리자로 접근 시 `{prefix}da_editor_images` 테이블이 자동 생성 됨.

최고관리자 외 접근 시에는 테이블 생성이 이뤄지지 않으며, 테이블 생성 전까지는 이 플러그인은 동작하지 않음.

> `data/cache/da-editor-images-updated.php` 파일에 테이블 생성 여부 등의 정보가 기록되므로, 테이블 생성이나 마이그레이션에 대한 반복하여 테스트하려면 이 파일을 삭제하면 됨.
> 이런 테스트 외에는 이 파일을 삭제할 필요 없음.
